<source>
  @type tail
  path /var/log/nginx/access.log
  pos_file /fluentd/log/nginx.log.pos
  tag cloud.nginx.access
  <parse>
    @type nginx
  </parse>
</source>

<filter cloud.**>
  @type record_modifier
  <record>
    source cloud
  </record>
</filter>

<match cloud.**>
  @type file
  path /fluentd/aggregated/cloud/%Y%m%d/logs.%H.log
  <buffer time,tag>
    @type file
    timekey 3600
    path /fluentd/log/buffer/cloud
  </buffer>
  <format>
    @type json
  </format>
</match>

<match **>
  @type stdout
</match>